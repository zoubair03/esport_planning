-- app/sql/schema.sql

-- 1. Create Database
CREATE DATABASE IF NOT EXISTS forum_db;
USE forum_db;

-- 2. Users Table (For Admins and Regular Users)
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role ENUM('user', 'admin') DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 3. Posts Table (The Forum Topics)
CREATE TABLE IF NOT EXISTS posts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    image VARCHAR(255) DEFAULT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- 4. Comments Table
CREATE TABLE IF NOT EXISTS comments (
    id INT AUTO_INCREMENT PRIMARY KEY,
    post_id INT NOT NULL,
    user_id INT NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- 5. Reactions Table (Like system)
CREATE TABLE IF NOT EXISTS reactions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    post_id INT NOT NULL,
    user_id INT NOT NULL,
    type ENUM('like', 'love', 'funny') DEFAULT 'like',
    FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE(post_id, user_id) -- Prevents user from liking the same post twice
);

-- 6. Insert Dummy Data (So you have something to see immediately)
-- Default Password is '123456' (hashed for security in a real app, but plain here for testing if you haven't set up hashing yet)
INSERT INTO users (name, email, password, role) VALUES 
('Admin User', 'admin@gmail.com', '123456', 'admin'),
('John Doe', 'john@gmail.com', '123456', 'user');

INSERT INTO posts (user_id, title, content, image) VALUES 
(1, 'Welcome to the Forum', 'This is the first post on our new MVC forum.', 'default.jpg'),
(2, 'Has anyone used this booking template?', 'I am trying to integrate the assets folder.', NULL);

INSERT INTO comments (post_id, user_id, content) VALUES 
(1, 2, 'Great work admin! Looks good.');